!function($){function fnFormatResult(a,b,c){var d="("+c.replace(reEscape,"\\$1")+")",e=">[";if(a.indexOf(e)>-1){try{var f=a.split(e),g=f[1];g.replace(new RegExp(d,"gi"),"$1")}catch(a){}return f[0]+e+g}return a.replace(new RegExp(d,"gi"),"$1")}function Autocomplete(a,b){this.el=$(a),this.el.attr("autocomplete","off"),this.suggestions=[],this.data=[],this.badQueries=[],this.selectedIndex=-1,this.currentValue=this.el.val(),this.intervalId=0,this.cachedResponse=[],this.onChangeInterval=null,this.ignoreValueChange=!1,this.serviceUrl=b.serviceUrl,this.isLocal=!1,this.options={autoSubmit:!1,minChars:1,maxHeight:300,deferRequestBy:0,width:0,highlight:!0,params:{},fnFormatResult:fnFormatResult,delimiter:null,zIndex:9999},this.initialize(),this.setOptions(b)}var reEscape=new RegExp("(\\"+["/",".","*","+","?","|","(",")","[","]","{","}","\\"].join("|\\")+")","g");$.fn.autocomplete=function(a){return new Autocomplete(this.get(0)||$("<input />"),a)},Autocomplete.prototype={killerFn:null,initialize:function(){var a,b,c;a=this,b=Math.floor(1048576*Math.random()).toString(16),c="Autocomplete_"+b,this.killerFn=function(b){0===$(b.target).parents(".autocomplete").length&&(a.killSuggestions(),a.disableKillerFn())},this.options.width||(this.options.width=this.el.width()),this.mainContainerId="AutocompleteContainter_"+b,$('<div id="'+this.mainContainerId+'" style="position:absolute;z-index:9999;"><div class="autocomplete-w1"><div class="autocomplete" id="'+c+'" style="display:none; width:300px;"></div></div></div>').appendTo("body"),this.container=$("#"+c),this.fixPosition(),window.opera?this.el.keypress(function(b){a.onKeyPress(b)}):this.el.keydown(function(b){a.onKeyPress(b)}),this.el.keyup(function(b){a.onKeyUp(b)}),this.el.blur(function(){a.enableKillerFn()}),this.el.focus(function(){a.fixPosition()})},setOptions:function(a){var b=this.options;$.extend(b,a),b.lookup&&(this.isLocal=!0,$.isArray(b.lookup)&&(b.lookup={suggestions:b.lookup,data:[]})),$("#"+this.mainContainerId).css({zIndex:b.zIndex}),this.container.css({maxHeight:b.maxHeight+"px",width:b.width})},clearCache:function(){this.cachedResponse=[],this.badQueries=[]},disable:function(){this.disabled=!0},enable:function(){this.disabled=!1},fixPosition:function(){var a=this.el.offset();$("#"+this.mainContainerId).css({top:a.top+this.el.innerHeight()+"px",left:a.left+"px"})},enableKillerFn:function(){var a=this;$(document).bind("click",a.killerFn)},disableKillerFn:function(){var a=this;$(document).unbind("click",a.killerFn)},killSuggestions:function(){var a=this;this.stopKillSuggestions(),this.intervalId=window.setInterval(function(){a.hide(),a.stopKillSuggestions()},300)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},onKeyPress:function(a){if(!this.disabled&&this.enabled){switch(a.keyCode){case 27:this.el.val(this.currentValue),this.hide();break;case 9:case 13:var b=$(".autocomplete div.selected a").attr("href");if(b&&(window.location.href=b),-1===this.selectedIndex)return void this.hide();if(this.select(this.selectedIndex),9===a.keyCode)return;break;case 38:this.moveUp();break;case 40:this.moveDown();break;default:return}a.stopImmediatePropagation(),a.preventDefault()}},onKeyUp:function(a){if(!this.disabled){switch(a.keyCode){case 38:case 40:return}if(clearInterval(this.onChangeInterval),this.currentValue!==this.el.val())if(this.options.deferRequestBy>0){var b=this;this.onChangeInterval=setInterval(function(){b.onValueChange()},this.options.deferRequestBy)}else this.onValueChange()}},onValueChange:function(){clearInterval(this.onChangeInterval),this.currentValue=this.el.val();var a=this.getQuery(this.currentValue);if(this.selectedIndex=-1,this.ignoreValueChange)return void(this.ignoreValueChange=!1);""===a||a.length<this.options.minChars?this.hide():this.getSuggestions(a)},getQuery:function(a){var b,c;return(b=this.options.delimiter)?(c=a.split(b),$.trim(c[c.length-1])):$.trim(a)},getSuggestionsLocal:function(a){var b,c,d,e,f;for(c=this.options.lookup,d=c.suggestions.length,b={suggestions:[],data:[]},a=a.toLowerCase(),f=0;f<d;f++)e=c.suggestions[f],0===e.toLowerCase().indexOf(a)&&(b.suggestions.push(e),b.data.push(c.data[f]));return b},getSuggestions:function(a){var b,c;b=this.isLocal?this.getSuggestionsLocal(a):this.cachedResponse[a],b&&$.isArray(b.suggestions)?(this.suggestions=b.suggestions,this.data=b.data,this.suggest()):this.isBadQuery(a)||(c=this,c.options.params.query=a,$.get(this.serviceUrl,c.options.params,function(a){c.processResponse(a)},"text"))},isBadQuery:function(a){for(var b=this.badQueries.length;b--;)if(0===a.indexOf(this.badQueries[b]))return!0;return!1},hide:function(){this.enabled=!1,this.selectedIndex=-1,this.container.hide()},suggest:function(){if(0===this.suggestions.length)return void this.hide();var a,b,c,d,e,f,g,h,i;for(a=this,b=this.suggestions.length,d=this.options.fnFormatResult,e=this.getQuery(this.currentValue),h=function(b){return function(){a.activate(b)}},i=function(b){return function(){a.select(b)}},this.container.hide().empty(),f=0;f<b;f++)g=this.suggestions[f],c=$((a.selectedIndex===f?'<div class="selected"':"<div")+">"+d(g,this.data[f],e)+"</div>"),c.mouseover(h(f)),c.click(i(f)),this.container.append(c);this.enabled=!0,this.container.show()},processResponse:function(text){var response;try{response=eval("("+text+")")}catch(a){return}$.isArray(response.data)||(response.data=[]),this.options.noCache||(this.cachedResponse[response.query]=response,0===response.suggestions.length&&this.badQueries.push(response.query)),response.query===this.getQuery(this.currentValue)&&(this.suggestions=response.suggestions,this.data=response.data,this.suggest())},activate:function(a){var b,c;return b=this.container.children(),-1!==this.selectedIndex&&b.length>this.selectedIndex&&$(b.get(this.selectedIndex)).removeClass(),this.selectedIndex=a,-1!==this.selectedIndex&&b.length>this.selectedIndex&&(c=b.get(this.selectedIndex),$(c).addClass("selected")),c},deactivate:function(a,b){a.className="",this.selectedIndex===b&&(this.selectedIndex=-1)},select:function(a){var b,c;(b=this.suggestions[a])&&(this.el.val(b),this.options.autoSubmit&&(c=this.el.parents("form"),c.length>0&&c.get(0).submit()),this.ignoreValueChange=!0,this.hide(),this.onSelect(a))},moveUp:function(){if(-1!==this.selectedIndex)return 0===this.selectedIndex?(this.container.children().get(0).className="",void(this.selectedIndex=-1)):void this.adjustScroll(this.selectedIndex-1)},moveDown:function(){this.selectedIndex!==this.suggestions.length-1&&this.adjustScroll(this.selectedIndex+1)},adjustScroll:function(a){var b,c,d,e;b=this.activate(a),c=b.offsetTop,d=this.container.scrollTop(),e=d+this.options.maxHeight-25,c<d?this.container.scrollTop(c):c>e&&this.container.scrollTop(c-this.options.maxHeight+25)},onSelect:function(a){var b,c,d,e;b=this,c=b.options.onSelect,d=b.suggestions[a],e=b.data[a],b.el.val(b.getValue(d)),$.isFunction(c)&&c(d,e,b.el)},getValue:function(a){var b,c,d,e;return e=this,(b=e.options.delimiter)?(c=e.currentValue,d=c.split(b),1===d.length?a:c.substr(0,c.length-d[d.length-1].length)+a):a}}}(jQuery);